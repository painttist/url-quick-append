"use strict";var urlIn=document.getElementById("url-input"),btnClean=document.getElementById("btn-clean"),btnCleanUndo=document.getElementById("btn-undo"),btnGo=document.getElementById("btn-go"),btnDropdownLinks=document.getElementById("btn-dropdown-links"),overlayDel=document.getElementById("overlay-delete"),btnOverlayCheck=document.getElementById("btn-overlay-check"),btnOverlayClose=document.getElementById("btn-overlay-close");const cacheKey="url-quick-append-cache",keywords=["密码","提取码","密碼","提取碼"];var theurl,lazyLoading=!0,urls=[],urlsName=[];btnGo.disabled=!0;var oldOpts=getCachedOpts(),selectedID=oldOpts.id,urlInText=oldOpts.urlInText,infoText=oldOpts.infoText;function getCachedOpts(){var e=localStorage.getItem(cacheKey);return e?JSON.parse(e):{id:0,urlInText:"",infoText:void 0}}function clearCache(){localStorage.removeItem(cacheKey)}function recordOpts(e){var n=getCachedOpts();localStorage.setItem(cacheKey,JSON.stringify(Object.assign({},n,e)))}function recordID(){recordOpts({id:selectedID})}function recordUrlInText(){recordOpts({urlInText:urlIn.value})}function recordInfoText(){recordOpts({infoText:infoText})}function getURLs(){chrome.storage.sync.get("urlsInfo",function(e){urls=e.urlsInfo.urls,urlsName=e.urlsInfo.urlsName,btnGo.disabled=!1,appendURLList()})}function setURLs(){chrome.storage.sync.set({urlsInfo:{urls:urls,urlsName:urlsName}},function(){})}function getOptions(){chrome.storage.sync.get("options",function(e){lazyLoading=e.options.lazyLoading})}function setDefaultURLs(){chrome.storage.sync.set({urlsInfo:{urlsName:["Google Search","Youtube Search","Bilibili Search","Bilibili ID","Bilibili Up","Baidu Drive","Pixiv ID","Pixiv Artists","Youtube ID","Yande.re ID"],urls:["https://www.google.com/search?q=","https://www.youtube.com/results?search_query=","https://search.bilibili.com/all?keyword=","https://www.bilibili.com/video/av","https://space.bilibili.com/","https://pan.baidu.com/s/","https://www.pixiv.net/member_illust.php?mode=medium&illust_id=","https://www.pixiv.net/member.php?id=","https://www.youtube.com/watch?v=","https://yande.re/post/show/"]}},function(){})}function goToURL(){urlIn.value.split("\n").forEach(function(e,n){theurl=urls[selectedID]+e,lazyLoading?chrome.tabs.create({url:chrome.extension.getURL("lazyloading.html#")+theurl,selected:!1}):chrome.tabs.create({url:theurl,selected:!1})})}selectedID=null==selectedID?0:selectedID,urlInText=null==urlInText?"":urlInText,infoText=null==infoText?[]:infoText,getOptions(),getURLs(),btnGo.onclick=goToURL,btnDropdownLinks.addEventListener("click",function(){if(event.target.classList.contains("icon-add")){panelDropdown.removeChild(panelDropdown.lastChild),urlsName.push("Name"),urls.push("URL");var e=appendToPanelDropdown(urls.length-1);e.children[1].classList.toggle("icon-mode_edit"),e.children[1].classList.toggle("icon-check"),e.children[0].readOnly=!e.children[0].readOnly,e.children[0].readOnly?clearSelection():e.children[0].select(),e.children[3].classList.toggle("edit"),e.classList.toggle("edit"),appendAddLink(),scrollTo(panelDropdown,panelDropdown.scrollHeight-panelDropdown.offsetHeight,250)}else toggleDropdown()});var beforeUndoUrlsInText,linksList=document.getElementsByClassName("link"),panelDropdown=document.getElementById("panel-dropdown-links");function appendURLList(){urls.forEach(function(e,n){appendToPanelDropdown(n)}),appendAddLink()}function appendAddLink(){var e=document.createElement("div");e.classList="line link",e.addEventListener("click",function(){e.parentNode.removeChild(e),urls.push("URL"),urlsName.push("Name");var n=appendToPanelDropdown(urls.length-1);n.children[1].classList.toggle("icon-mode_edit"),n.children[1].classList.toggle("icon-check"),n.children[0].readOnly=!n.children[0].readOnly,n.children[0].readOnly?clearSelection():n.children[0].select(),n.children[3].classList.toggle("edit"),n.classList.toggle("edit"),appendAddLink(),scrollTo(panelDropdown,panelDropdown.scrollHeight-panelDropdown.offsetHeight,250)});var n=document.createElement("span");n.classList="link-btn-add icon-add",n.innerHTML=" Add",e.appendChild(n),panelDropdown.appendChild(e),changeLink(selectedID)}function appendToPanelDropdown(e){var n=document.createElement("div");n.classList="line link",n.addEventListener("mouseover",function(){changeLink(e)}),n.addEventListener("click",function(){event.target.classList.contains("link-btn-delete")?(overlayDel.classList.toggle("on"),selectedID=e):event.target.classList.contains("link-btn-edit")?toggleLinkEdit(e):n.classList.contains("edit")&&(event.target.classList.contains("link-name")||event.target.classList.contains("link-url"))?selectedID=e:(urlsName[e]=n.children[0].value,urls[e]=n.children[3].value,setURLs(),event.target.classList.contains("link")&&event.target.children[1].classList.contains("icon-check")&&toggleLinkEdit(e),selectedID=e,changeLink(e),toggleDropdown())});var t=document.createElement("input");t.id="link-input-name-"+e,t.classList="line-first link-input link-name",t.value=urlsName[e],t.readOnly=!0;var l=document.createElement("input");l.id="link-input-url-"+e,l.classList="link-input link-url",l.value=urls[e];var o=document.createElement("span");o.classList="link-btn-delete icon-delete";var i=document.createElement("span");return i.classList="link-btn-edit icon-mode_edit",n.appendChild(t),n.appendChild(i),n.appendChild(o),n.appendChild(l),panelDropdown.appendChild(n),n}function changeLink(e){e>=urls.length&&(e=selectedID=urls.length-1),document.getElementById("link-selected").innerHTML=urlsName[e],recordID()}function toggleDropdown(){btnDropdownLinks.classList.toggle("expanded");var e=document.getElementById("panel-dropdown-links");e.classList.toggle("show"),e.classList.contains("show")?document.getElementById("dropdown-icon").classList="icon-expand_less":document.getElementById("dropdown-icon").classList="icon-expand_more",setURLs()}function clearSelection(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function undoClearInput(){btnCleanUndo.classList.add("hidden"),urlIn.value=beforeUndoUrlsInText,urlIn.focus(),checkInputToClean(),autoExpand(urlIn)}overlayDel.addEventListener("click",function(){event.target.classList.contains("btn-overlay")?event.target.classList.contains("icon-check")?(panelDropdown.children[selectedID].classList.add("removed"),setTimeout(function(){panelDropdown.innerHTML="",urls.splice(selectedID,1),urlsName.splice(selectedID,1),appendURLList(),setURLs()},250),overlayDel.classList.toggle("on")):event.target.classList.contains("icon-close")&&overlayDel.classList.toggle("on"):event.target.classList.contains("overlay")&&overlayDel.classList.toggle("on")}),document.addEventListener("input",function(e){"textarea"===e.target.tagName.toLowerCase()&&(recordUrlInText(),autoExpand(e.target),checkInputToClean(),btnCleanUndo.classList.add("hidden"))},!1),btnClean.onclick=cleanInput,btnCleanUndo.onclick=undoClearInput;const regKey=RegExp("["+keywords.join("")+"]{2,3} *:+ *\\S*","gm"),regKeySingle=RegExp("["+keywords.join("")+"]{2,3} *:+ *\\S*"),regColonClean=/[\s\S]*:+ */g,regColon=/:+[^:\s]+/g;function cleanInput(){beforeUndoUrlsInText=urlIn.value;var e=urlIn.value;if(e){var n=(e=e.replace("：",":")).match(regKey),t=(e=(e=(e=(e=e.replace(regKey," ")).replace(/\/$/gm,"")).replace(/\/\s/g," ")).replace(/(\S*\/)+/g,"\n")).match(regColon);e=e.replace(regColon," ");var l=[];n&&(l=l.concat(n)),t&&(l=l.concat(t)),l&&l.forEach(function(e,n){var t=e.replace(regColonClean,"");t.length>0&&infoText.push(t)});var o=e.match(/\S+/g);o?o.join("\n"):o="",refreshInfo(),recordInfoText(),urlIn.value=o,btnCleanUndo.classList.remove("hidden"),recordUrlInText(),checkInputToClean(),urlIn.focus(),autoExpand(urlIn)}}function checkInputToClean(){var e=urlIn.value,n=!1;e.match("/")&&(n=!0),e.replace("：",":").match(/:\S/)&&(n=!0),e.match(regKeySingle)&&(n=!0),n?(urlIn.classList.add("toClean"),btnClean.classList.remove("hidden")):(urlIn.classList.remove("toClean"),btnClean.classList.add("hidden"))}var autoExpand=function(e){var n=parseInt(e.style.height,10);e.style.height="inherit";var t=window.getComputedStyle(e),l=(parseInt(e.clientHeight,10),parseInt(t.getPropertyValue("line-height"),10)),o=l+parseInt(t.getPropertyValue("padding-top"),10)+parseInt(t.getPropertyValue("padding-bottom"),10),i=parseInt(t.getPropertyValue("max-height"),10),a=e.scrollHeight-o+l;if(a>n&&a>i){var s=a-o-l;e.scrollTop=s}e.style.height=a+"px"};function scrollTo(e,n,t){var l=e.scrollTop,o=n-l,i=0,a=function(){i+=20;var n=Math.easeInOutQuad(i,l,o,t);e.scrollTop=n,i<t&&setTimeout(a,20)};a()}function toggleLinkEdit(e){var n=panelDropdown.children[e],t=n.children[0],l=n.children[1],o=(n.children[2],n.children[3]);l.classList.contains("icon-check")&&(urlsName[e]=t.value,urls[e]=o.value,setURLs()),l.classList.toggle("icon-mode_edit"),l.classList.toggle("icon-check"),t.readOnly=!t.readOnly,t.readOnly?clearSelection():t.select(),o.classList.toggle("edit"),n.classList.toggle("edit")}function displayInfo(){if(!(infoText.length<=0)){var e=document.getElementById("line-info-container");infoText.forEach(function(n,t){var l=document.createElement("button");l.classList.add("btn-info"),l.innerHTML=n,e.appendChild(l)}),Array.from(document.getElementsByClassName("btn-info")).forEach(function(e,n){e.onclick=function(){copyToClipboard(this.innerHTML),removeInfoText(this.innerHTML),urlIn.focus(),this.innerHTML="Copied",this.style.width=this.clientWidth,this.onclick=function(e){e.target.remove()};var e=this;setTimeout(function(){e.classList.add("toShrink")},500),this.addEventListener("transitionend",function(e){"width"==e.propertyName?e.target.remove():e.target.classList.add("toShrinkWidth")})}})}}function animateCSS(e,n,t){const l="object"==typeof e?e:document.querySelector(e);l.classList.add("animated",n),l.addEventListener("animationend",function e(){l.classList.remove("animated",n),l.removeEventListener("animationend",e),"function"==typeof t&&t(l)})}function clearInfo(){document.getElementById("line-info-container").innerHTML=""}function refreshInfo(){clearInfo(),displayInfo()}function removeInfoText(e){var n=infoText.indexOf(e);n>-1&&infoText.splice(n,1),recordInfoText()}urlIn.value=urlInText,urlIn.focus(),urlIn.select(),autoExpand(urlIn),checkInputToClean(),Math.easeInOutQuad=function(e,n,t,l){return(e/=l/2)<1?t/2*e*e+n:-t/2*(--e*(e-2)-1)+n},document.addEventListener("keydown",function(e){var n=document.activeElement.id,t=parseInt(n.substring(n.length-1,n.length)),l=document.getElementById(n);13==e.keyCode&&("input"==l.tagName.toLowerCase()?(e.preventDefault(),toggleLinkEdit(t)):"textarea"==l.tagName.toLowerCase()&&e.shiftKey&&(e.preventDefault(),goToURL()))}),displayInfo(),String.prototype.isEmpty=function(){return 0===this.length||!this.trim()};const copyToClipboard=e=>{const n=document.createElement("textarea");n.value=e,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n);const t=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);n.select(),document.execCommand("copy"),document.body.removeChild(n),t&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(t))};